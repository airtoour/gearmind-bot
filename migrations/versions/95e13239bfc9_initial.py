"""Initial

Revision ID: 95e13239bfc9
Revises: 
Create Date: 2025-03-15 17:05:46.464574

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

import db
from db.models.prompts.schemas import TypesEnum
from db.models.users.schemas import UsersRolesTypeDecorator

# revision identifiers, used by Alembic.
revision: str = '95e13239bfc9'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('prompts',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('type', db.models.prompts.schemas.EnumsDecorator(length=17, enum_class=TypesEnum),
                              nullable=False),
                    sa.Column('text', sa.String(), nullable=False),
                    sa.PrimaryKeyConstraint('id')
                    )
    op.create_index('idx_prompts_type_text', 'prompts', ['type', 'text'], unique=False)
    op.create_index(op.f('idx_prompts_text'), 'prompts', ['text'], unique=False)
    op.create_index(op.f('idx_prompts_type'), 'prompts', ['type'], unique=False)

    op.create_table('users',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('tg_user_id', sa.BigInteger(), nullable=False),
                    sa.Column('name', sa.String(), nullable=False),
                    sa.Column('role', UsersRolesTypeDecorator(length=13), nullable=False),
                    sa.PrimaryKeyConstraint('id')
                    )
    op.create_index('idx_users_tg_user_id', 'users', ['tg_user_id'], unique=True)

    op.create_table('cars',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('user_id', sa.UUID(), nullable=False),
                    sa.Column('brand_name', sa.String(), nullable=False),
                    sa.Column('model_name', sa.String(), nullable=False),
                    sa.Column('gen_name', sa.String(), nullable=False),
                    sa.Column('year', sa.Integer(), nullable=False),
                    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
                    sa.PrimaryKeyConstraint('id')
                    )
    op.create_table('requests',
                    sa.Column('id', sa.UUID(), nullable=False),
                    sa.Column('date', sa.DateTime(), nullable=False),
                    sa.Column('prompt_id', sa.UUID(), nullable=False),
                    sa.Column('text', sa.String(), nullable=False),
                    sa.Column('response', sa.String(), nullable=False),
                    sa.Column('response_data', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
                    sa.ForeignKeyConstraint(['prompt_id'], ['prompts.id'], ),
                    sa.PrimaryKeyConstraint('id')
                    )
    # ### insert into Tables Base Info
    op.execute('CREATE EXTENSION IF NOT EXISTS "uuid-ossp"')
    op.execute(
        """
        WITH bot_data AS (
            SELECT uuid_generate_v4() AS id,
                   7433112188         AS tg_user_id,
                   'GearMindBot'      AS name,
                   '–ë–æ—Ç'              AS role
        )
        INSERT INTO users(id, tg_user_id, name, role)
             SELECT id, tg_user_id, name, role
               FROM bot_data
        """
    )
    op.execute(
        """
        WITH prompt_data AS (
            SELECT uuid_generate_v4() AS id,
                   '–ó–∞–ø—á–∞—Å—Ç–∏' AS type,
                   '–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∫. –°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π –ø—Ä–∞–≤–∏–ª–∞:
                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä—ã–Ω–æ–∫ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º <carinfo> –∏ –¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –µ–º—É –ø–æ–º–æ–∂–µ—Ç.

                    ### –ñ—ë—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
                    1. **–¢–æ–ª—å–∫–æ HTML-—Ç–µ–≥–∏**:
                       - –î–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: <b>—Ç–µ–∫—Å—Ç</b>
                       - –ó–∞–ø—Ä–µ—â–µ–Ω–æ: **—Ç–µ–∫—Å—Ç**, __—Ç–µ–∫—Å—Ç__, –ª—é–±—ã–µ Markdown-—Å–∏–º–≤–æ–ª—ã.

                    2. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
                    –•–æ—Ä–æ—à–æ, <username>!

                    üìå <b>–î–∏–∞–≥–Ω–æ–∑:</b> [–ü—Ä–æ–±–ª–µ–º–∞ + –ø—Ä–∏—á–∏–Ω–∞] 

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>–û—Ä–∏–≥–∏–Ω–∞–ª</b> –ù–∞–∑–≤–∞–Ω–∏–µ: –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞. –¶–µ–Ω–∞: ~XXXX —Ä—É–±–ª–µ–π
                    2. <b>–ê–Ω–∞–ª–æ–≥</b> –ù–∞–∑–≤–∞–Ω–∏–µ: –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞. –¶–µ–Ω–∞: ~XXXX —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> [–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ë–ï–ó —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤]

                    3. **–ó–∞–ø—Ä–µ—â–µ–Ω–æ**:
                       - –°–∏–º–≤–æ–ª—ã * –∏–ª–∏ ** –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
                       - –°—Å—ã–ª–∫–∏, –∞—Ä—Ç–∏–∫—É–ª—ã, –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã
                       - –õ—é–±—ã–µ —Ç–µ–≥–∏ –∫—Ä–æ–º–µ <b>

                    ### –ü—Ä–∏–º–µ—Ä –ö–û–†–†–ï–ö–¢–ù–û–ì–û –æ—Ç–≤–µ—Ç–∞:
                    –•–æ—Ä–æ—à–æ, <username>!

                    üìå <b>–î–∏–∞–≥–Ω–æ–∑:</b> –°—Ç—É–∫ –≤ –ø–æ–¥–≤–µ—Å–∫–µ (–∏–∑–Ω–æ—Å —à–∞—Ä–æ–≤–æ–π –æ–ø–æ—Ä—ã)

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>TRW Original</b>: –†–µ—Å—É—Ä—Å 80 000 –∫–º. –¶–µ–Ω–∞: ~9990 —Ä—É–±–ª–µ–π
                    2. <b>CTR –ê–Ω–∞–ª–æ–≥</b>: –ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞. –¶–µ–Ω–∞: ~5499 —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> CTR ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏.

                    ### –ü—Ä–∏–º–µ—Ä –ù–ï–ö–û–†–†–ï–ö–¢–ù–û–ì–û –æ—Ç–≤–µ—Ç–∞ (–∑–∞–ø—Ä–µ—â—ë–Ω!):
                    üìå **–î–∏–∞–≥–Ω–æ–∑:** –°—Ç—É–∫ –≤ –ø–æ–¥–≤–µ—Å–∫–µ...

                    üéØ **–í–∞—Ä–∏–∞–Ω—Ç—ã:**
                    1. **TRW Original** ‚Äî —Ä–µ—Å—É—Ä—Å 80–∫ –∫–º. –¶–µ–Ω–∞: 9 990 —Ä—É–±.

                    üí° **–°–æ–≤–µ—Ç:** –í—ã–±–∏—Ä–∞–π—Ç–µ CTR –∏–∑-–∑–∞ —Ü–µ–Ω—ã.' AS text
             UNION ALL
            SELECT uuid_generate_v4(),
                   '–ñ–∏–¥–∫–æ—Å—Ç–∏ –¥–ª—è –∞–≤—Ç–æ',
                   '–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–≤—Ç–æ—Ö–∏–º–∏–∏. –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –ø—Ä–∞–≤–∏–ª–∞–º:
                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä—ã–Ω–æ–∫ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º <carinfo> –∏ –¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –µ–º—É –ø–æ–º–æ–∂–µ—Ç.

                    –•–æ—Ä–æ—à–æ, <username>!

                    üìå <b>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</b> [–î–æ–ø—É—Å–∫, –≤—è–∑–∫–æ—Å—Ç—å, —Ä–µ–≥–∏–æ–Ω] 

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>–ú–∞—Ä–∫–∞ + –ù–∞–∑–≤–∞–Ω–∏–µ</b>: [–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏]. –¶–µ–Ω–∞: ~XXXX —Ä—É–±–ª–µ–π
                    2. <b>–ú–∞—Ä–∫–∞ + –ù–∞–∑–≤–∞–Ω–∏–µ</b>: [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å]. –¶–µ–Ω–∞: ~XXXX —Ä—É–±–ª–µ–π
                    3. <b>–ú–∞—Ä–∫–∞ + –ù–∞–∑–≤–∞–Ω–∏–µ</b>: [–ö—Ä–∞—Ç–∫–æ]. –¶–µ–Ω–∞: ~XXXX —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è + —Ä–∏—Å–∫–∏]

                    –ü—Ä–∞–≤–∏–ª–∞:
                    1. –¢–æ–ª—å–∫–æ —Ç–µ–≥ <b> –∏ —Ü–∏—Ñ—Ä—ã (–Ω–∏–∫–∞–∫–∏—Ö <u>, <i>, —Å—Å—ã–ª–æ–∫ –∏ markdown)
                    2. –¶–µ–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: ~4500 —Ä—É–±–ª–µ–π
                    3. –ù–µ –±–æ–ª–µ–µ 5 —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –Ω–∞ –ø—É–Ω–∫—Ç
                    4. –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –¥–æ 5 –ø–æ–∑–∏—Ü–∏–π
                    5. –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî "–Ω–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"

                    –ü—Ä–∏–º–µ—Ä:
                    –•–æ—Ä–æ—à–æ, <username>!

                    üìå <b>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</b> –°–∏–Ω—Ç–µ—Ç–∏–∫–∞ 5W-30, –¥–æ–ø—É—Å–∫ API SP

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>Mobil Super 3000</b>: –ü–æ–ª–Ω—ã–π —Å–∏–Ω—Ç–µ–∑, –∑–∞—â–∏—Ç–∞ -40¬∞C. –¶–µ–Ω–∞: ~4299 —Ä—É–±–ª–µ–π
                    2. <b>ZIC X7</b>: –í—Å–µ—Å–µ–∑–æ–Ω–Ω–æ–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç—É—Ä–±–∏–Ω–æ–π. –¶–µ–Ω–∞: ~3190 —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> Mobil ‚Äî –ª—É—á—à–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–≥–æ –∫–ª–∏–º–∞—Ç–∞. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å–ª–∞ –±–µ–∑ API SP!'
             UNION ALL
            SELECT uuid_generate_v4(),
                   '–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',
                   '–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –∞ —Ç–∞–∫–∂–µ —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤. –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –ø—Ä–∞–≤–∏–ª–∞–º:

                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä—ã–Ω–æ–∫ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - <carinfo> –∏ –∑–∞–ø—Ä–æ—Å–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∏–∂–µ:
                    –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
                    –•–æ—Ä–æ—à–æ, <username>!

                    üìå [–û–ø–∏—à–∏ –∑–∞–ø—Ä–æ—Å –≤ 5-7 —Å–ª–æ–≤]

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>[–ë—Ä–µ–Ω–¥]</b> [–¢–∏–ø]: [–ê—Ä–æ–º–∞—Ç], [–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å]. –¶–µ–Ω–∞: ~[XXXX] —Ä—É–±–ª–µ–π
                    2. <b>[–ë—Ä–µ–Ω–¥]</b> [–¢–∏–ø]: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]. –¶–µ–Ω–∞: ~[XXXX] —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –≤ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ]

                    –ü—Ä–∞–≤–∏–ª–∞:
                    1. –ó–∞–ø—Ä–µ—â–µ–Ω—ã: —Å—Å—ã–ª–∫–∏, markdown (–Ω–∞–ø—Ä–∏–º–µ—Ä, **), —Ç–µ–≥–∏ –∫—Ä–æ–º–µ <b> 
                    2. –¶–µ–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: 1500 —Ä—É–±
                    3. –ù–∏–∫–∞–∫–∏—Ö HTML-–∞—Ç—Ä–∏–±—É—Ç–æ–≤: type="disc" –∏ —Ç.–ø.
                    4. –ú–∞–∫—Å–∏–º—É–º 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    5. –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö ‚Äî –Ω–∞–ø–∏—à–∏ "–Ω–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"

                    –ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
                    –•–æ—Ä–æ—à–æ, <username>!
                    üìå <b>–ü—Ä–æ–±–ª–µ–º–∞:</b> –ù—É–∂–µ–Ω –∞—Ä–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä —Å –ª–∞–≤–∞–Ω–¥–æ–π –¥–ª—è –∑–µ—Ä–∫–∞–ª–∞

                    üéØ <b>–í–∞—Ä–∏–∞–Ω—Ç—ã:</b>
                    1. <b>Eikosha</b> Premium: –ª–∞–≤–∞–Ω–¥–∞, –º–µ–ª–æ–≤–æ–π –Ω–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å. –¶–µ–Ω–∞: ~1800 —Ä—É–±–ª–µ–π
                    2. <b>Areon</b> Classic: –ª–∞–≤–∞–Ω–¥–∞, 45 –¥–Ω–µ–π –¥–µ–π—Å—Ç–≤–∏—è. –¶–µ–Ω–∞: ~600 —Ä—É–±–ª–µ–π

                    üí° <b>–°–æ–≤–µ—Ç:</b> Areon ‚Äî –æ–ø—Ç–∏–º–∞–ª–µ–Ω –ø–æ —Å—Ä–æ–∫—É –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ü–µ–Ω–µ'
        )

        INSERT INTO prompts(id, type, text)
             SELECT id, type, text
               FROM prompt_data
        """
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('requests')
    op.drop_table('cars')
    op.drop_index(op.f('ix_users_tg_user_id'), table_name='users')
    op.drop_index('idx_users_tg_user_id', table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_prompts_type'), table_name='prompts')
    op.drop_index(op.f('ix_prompts_text'), table_name='prompts')
    op.drop_index('idx_prompts_type_text', table_name='prompts')
    op.drop_table('prompts')
    # ### end Alembic commands ###
